```
mkdir -p /storage/minio
```



```yaml
---
# 1. 本地持久卷
apiVersion: v1
kind: PersistentVolume
metadata:
  name: minio-local-pv
spec:
  capacity:
    storage: 20Gi
  accessModes: ["ReadWriteOnce"]
  persistentVolumeReclaimPolicy: Retain
  storageClassName: local-minio
  local:
    path: /storage/minio # 节点上提前 mkdir -p /storage/minio
  nodeAffinity:
    required:
      nodeSelectorTerms:
      - matchExpressions:
        - key: kubernetes.io/hostname
          operator: In
          values:
          - izrj943cxeelu8yy8nt47tz # <-- 改成你的节点名
---
# 2. PVC
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: minio-data
  namespace: mid
spec:
  accessModes: ["ReadWriteOnce"]
  storageClassName: local-minio
  resources:
    requests:
      storage: 20Gi
---
# 3. Secret（ak/sk）
apiVersion: v1
kind: Secret
metadata:
  name: minio-secret
  namespace: mid
type: Opaque
stringData:
  rootUser: "minio"
  rootPassword: "mInio123456_"
---
# 4. Deployment（单副本，仅 demo）
apiVersion: apps/v1
kind: Deployment
metadata:
  name: minio
  namespace: mid
spec:
  replicas: 1
  selector:
    matchLabels: { app: minio }
  template:
    metadata:
      labels: { app: minio }
    spec:
      nodeSelector: # 固定节点
        kubernetes.io/hostname: izrj943cxeelu8yy8nt47tz
      initContainers:
      - name: fix-perm
        image: busybox:1.37
        command: ['sh', '-c', 'chown -R 1000:1000 /data']
        volumeMounts:
        - name: data
          mountPath: /data
      containers:
      - name: minio
        image: quay.io/minio/minio:RELEASE.2025-09-07T16-13-09Z # https://quay.io/repository/minio/minio?tab=tags
        args: ["server", "/data", "--console-address", ":9001"]
        env:
        - name: MINIO_ROOT_USER
          valueFrom:
            secretKeyRef: { name: minio-secret, key: rootUser }
        - name: MINIO_ROOT_PASSWORD
          valueFrom:
            secretKeyRef: { name: minio-secret, key: rootPassword }
        ports:
        - containerPort: 9000
          name: s3
        - containerPort: 9001
          name: console
        volumeMounts:
        - name: data
          mountPath: /data
        livenessProbe:
          httpGet:
            path: /minio/health/live
            port: 9000
          initialDelaySeconds: 30
          periodSeconds: 30
        readinessProbe:
          httpGet:
            path: /minio/health/ready
            port: 9000
          initialDelaySeconds: 10
          periodSeconds: 10
        resources:
          requests:
            cpu: "500m"
            memory: "512Mi"
          limits:
            cpu: "1"
            memory: "1Gi"
      volumes:
      - name: data
        persistentVolumeClaim:
          claimName: minio-data
---
# 5. Service
apiVersion: v1
kind: Service
metadata:
  name: minio
  namespace: mid
spec:
  type: NodePort
  ports:
  - port: 9000
    targetPort: 9000
    nodePort: 30090
    name: s3
  - port: 9001
    targetPort: 9001
    nodePort: 30091
    name: console
  selector: { app: minio }
```



```bash
kubectl apply -f minio-local.yaml
kubectl get pod -n mid
```



1. 访问
   - 控制台 https://<节点IP>:30091  账号 minio / mInio123456_
   - S3 端点  http://<节点IP>:30090











