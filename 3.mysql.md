1. 使用 MySQL 8 官方镜像；
2. 默认端口 3306，NodePort 暴露为 `30001`；
3. 初始化 root 密码、用户（`mysql-user`/`mysql-pass`）均通过 Secret 注入；
4. 数据目录 `/var/lib/mysql` 挂到同节点的 local PV；
5. readiness / liveness 探针改用 `mysqladmin ping`；
6. 字符集默认 utf8mb4。

使用前请把节点名 `izrj943cxeelu84r2mp9acz` 换成你的真实节点，并提前在对应节点创建 `/storage/mysql` 目录。

```
sudo mkdir -p /storage/mysql
sudo chown -R 999:999 /storage/mysql
```



mysql-local.yaml

```yaml
# 1. 本地持久卷
apiVersion: v1
kind: PersistentVolume
metadata:
  name: mysql-local-pv
spec:
  capacity:
    storage: 20Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  storageClassName: local-mysql
  local:
    path: /storage/mysql # 节点本地路径，需提前在节点建好 /storage/mysql 目录
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - izrj943cxeelu84r2mp9acz   # 此处改为指定的 k8s 节点名

---
# 2. PVC（命名空间 mid）
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-data
  namespace: mid
spec:
  accessModes: [ "ReadWriteOnce" ]
  storageClassName: local-mysql
  resources:
    requests:
      storage: 20Gi

---
# 3. 密码 Secret
apiVersion: v1
kind: Secret
metadata:
  name: mysql-auth
  namespace: mid
type: Opaque
stringData:
  root-password: "mYsql123456_"

---
# 4. MySQL 8 单副本 Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql
  namespace: mid
spec:
  replicas: 1
  selector:
    matchLabels: { app: mysql }
  template:
    metadata:
      labels: { app: mysql }
    spec:
      nodeSelector: # 与 PV 同节点
        kubernetes.io/hostname: izrj943cxeelu84r2mp9acz
      containers:
        - name: mysql
          image: mysql:8.0
          env:
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mysql-auth
                  key: root-password
            #- name: MYSQL_USER
            #  valueFrom:
            #    secretKeyRef:
            #      name: mysql-auth
            #      key: mysql-user
            #- name: MYSQL_PASSWORD
            #  valueFrom:
            #    secretKeyRef:
            #      name: mysql-auth
            #      key: mysql-password
            #- name: MYSQL_DATABASE
            #  valueFrom:
            #    secretKeyRef:
            #      name: mysql-auth
            #      key: mysql-database
          ports:
            - containerPort: 3306
          volumeMounts:
            - name: data
              mountPath: /var/lib/mysql
          args:
            - "--character-set-server=utf8mb4"
            - "--collation-server=utf8mb4_unicode_ci"
          livenessProbe:
            exec:
              command: ["mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$(MYSQL_ROOT_PASSWORD)"]
            initialDelaySeconds: 30
            periodSeconds: 10
          readinessProbe:
            exec:
              command: ["mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$(MYSQL_ROOT_PASSWORD)"]
            initialDelaySeconds: 10
            periodSeconds: 5
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: mysql-data

---
# 5. NodePort Service
apiVersion: v1
kind: Service
metadata:
  name: mysql
  namespace: mid
spec:
  type: NodePort
  ports:
    - port: 3306
      targetPort: 3306
      nodePort: 30001
  selector: { app: mysql }
```





```shell
kubectl apply -f mysql-local.yaml
kubectl -n mid get pod,svc,pv,pvc
kubectl -n mid exec -it deploy/mysql -- mysql -uroot -pMySQL123456_
```

